<script type="text/javascript">
var refreshIntervalId;
var tableRegistros;
$('#generate').click(function(){
    toastr.clear();
    
    $.ajax({
        method: "POST",
        data: {"Email":$('#gemail').val()},
        url:   "{{ path('registro_consultarbuscaremail_ajax') }}",
        dataType: 'json',
        success: function(data){
            if(data){
               $("#load").val("true");
            }else{
               $("#load").val("false");
               toastr.error("El usuario no se encuentra registrado, esta inactivo o no a realizado el registro de datos.", "Error", {
                                "timeOut": "0",
                                "extendedTImeout": "0"
                             });
            }
        }
    });
    refreshIntervalId = setInterval(initTableConsultar, 2500);
});

function initTableConsultar(){
    if($("#load").val() == "true")
    {
         tableRegistros = $('#tableRegistros').DataTable({
                    	    "ajax":{
                               "url": "{{ path('registro_consultarregistros_ajax') }}",
                               "type": 'POST',
                               "data": {"email":$('#gemail').val()}
                            },
                    	    "language": {
                                	"url": "{{ asset('assets/js/datatable-spanish.json') }}"
                            },
                            columns: [
                               {"data":"TipoDeReferencia"},
                               {"data":"Descripcion"},
                               {"data":"Nivel"},
                               {"data":"Estatus"},
                               {"data":"AnoDePublicacionAsistencia"},
                               {"data":"EmpresaInstitucion"}
                            ]
                        });
        $("#load").val("false");
        clearInterval(refreshIntervalId);
    }
}
</script>